# Lambda

- インフラを気にすることなくアプリケーションコードを実行できるデータ処理サービス

## 特徴

- 実行基盤は全て AWS が管理
- AWS サービスと連携させることで簡単にイベントドリブンなアプリケーションを実装可能
- Node.js / Java で書かれたコードを実行（他にGo, PowerShell, C# Python, Rubyをサポート）
  - 関数の作成にその他のプログラミング言語を使用できるようにするための Runtime API を提供している
- 100ミリ秒単位でコード実行時間に対しての課金であり、コスト効率が非常に高い
- SDK を利用してアプリケーションに組み込むことができる
- オートスケール
- Lambda関数を呼び出すたびに使用できる一時ボリューム量は最大 512MB

## 仕組み

利用方法もシンプルで WEB アプリやモバイルアプリから簡単に利用可能

- Lambda ファンクションを用意する（コーディング）
- アプリから Lambda を呼び出す

イベント発生後に数ミリ秒以内に Lambda コードが実行される

- 画像のアップロードをトリガーとして
- アプリケーション内の実行処理をトリガーとして
- ウェブサイトのクリックをトリガーとして
- 接続デバイスからの出力をトリガーとして

## 起動

- Push モデル
  - S3 / Cognito / SNS などの AWS サービスとカスタムイベントが直接実行することにより起動する Lambda ファンクション
    - サービスもしくはアプリが直接実行する
    - 順不同
    - 3回までリトライ
- Pull モデル
  - Lambda 自らがデータを取得するために Pull モデルという
  - Dynamo DB と Kinesis などのデータ処理は Lambda に対して直接的にイベント発行を行わないため Lambda がそれらへポーリングを行い自らイベントを取得
    - ストリームに入ってきた順に処理される
    - イベントソースとして登録したストリームに対して Lambda が自動的にデータ取得などのファンクションを実行する
    - イベントごとに複数レコードを取得可能
    - データが期限切れになるまでリトライ

## 処理タイミング

- 非同期実行
- 同期実行

## パーミッション

- Execution
  - Lambda ファンクションが AWS リソースにどういったアクションを実施させるかを決定する
  - 指定された IAM ロールに沿って AWS のリソースへのアクセスが許可される
- Invocation
  - Lambda ファンクションをどのリソースが実行できるかを決定する

## 連携

- S3
- Kinesis
- DynamoDB Streams
- Cognito(Sync)
- SNS
- Alexa Skills Kit
- SWF

## ブループリント

Lambda ファンクションをコーディングする際にサンプルコード集を利用することが可能

## スケジューリング機能

特定時刻をトリガーにして Lambda ファンクションを実行する

## バージョニング

ファンクションの一時点を記録管理することが可能

## VPC アクセス

インターネットを経由せずに VPC 内の AWS リソースへとアクセス可能になる

## Lambda Layer

Lambda ファンクション間で共通するコンポーネントを Lambda Layer として定義し参照できる（5つまで）

## ロードバランサー機能

ALB のバックエンドに Lambda を呼び出すことが可能になり、 WEB アプリに Lambda ファンクションを組み込みやすくなった

## ユースケース

- Amazon Echo の音声処理をトリガーとして Alexa スキルを呼び出す
- S3 内の CloudTrailのログ分析により異常を検知した場合に Lambda を起動してメール通知する

### 起動のスケーリング

- Lambda ファンクションでストリーミングデータの傾向に応じてスケーリングトリガーとなる

### モバイルアプリのバックエンド

- モバイルからの写真管理を Lambda を通して実施するなどモバイル連携も可能

## Lambda エッジ

- Lambda の機能と CloudFront のエッジロケーション処理の機能を合わせたサービス
- CloudFront に Lambda 機能を連携し、世界中でインフラをユーザーに近いロケーションでコード実行可能にする
- イベントに関連付けられて Lambda ファンクションがエッジロケーションで実行されて実行結果を返答する
